# 🔄 Fluxo de Tratamento de Erros - Diagrama Visual

## 📊 Arquitetura Geral

```
┌─────────────────────────────────────────────────────────────┐
│                     RootErrorBoundary                        │
│                   (Erros Críticos)                           │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                   ToastProvider                        │  │
│  │              (Sistema de Notificações)                 │  │
│  │  ┌─────────────────────────────────────────────────┐  │  │
│  │  │              Application Pages                   │  │  │
│  │  │  ┌───────────────────────────────────────────┐  │  │  │
│  │  │  │         ErrorBoundary (Page)              │  │  │  │
│  │  │  │  ┌─────────────────────────────────────┐  │  │  │  │
│  │  │  │  │   ErrorBoundary (Section)           │  │  │  │  │
│  │  │  │  │  ┌───────────────────────────────┐  │  │  │  │  │
│  │  │  │  │  │      Your Components          │  │  │  │  │  │
│  │  │  │  │  │   (useAsyncError, etc)        │  │  │  │  │  │
│  │  │  │  │  └───────────────────────────────┘  │  │  │  │  │
│  │  │  │  └─────────────────────────────────────┘  │  │  │  │
│  │  │  └───────────────────────────────────────────┘  │  │  │
│  │  └─────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 🔄 Fluxo de Erro - Passo a Passo

### 1. Erro Ocorre

```
┌─────────────────┐
│  Erro Ocorre    │
│  (Component,    │
│   API, etc)     │
└────────┬────────┘
         │
         ▼
    ┌────────┐
    │ Tipo?  │
    └───┬────┘
        │
   ┌────┴────┬────────┬──────────┐
   │         │        │          │
   ▼         ▼        ▼          ▼
Network   Validation  404    Outros
```

### 2. Captura e Classificação

```
┌──────────────────────────────────────────────────────────┐
│                    Error Handler                          │
├──────────────────────────────────────────────────────────┤
│                                                           │
│  1. Captura o erro                                       │
│  2. Classifica o tipo (Network, Validation, etc)         │
│  3. Determina se é retryable                             │
│  4. Loga o erro                                          │
│  5. Envia para monitoring (produção)                     │
│                                                           │
└────────────────────┬─────────────────────────────────────┘
                     │
                     ▼
```

### 3. Decisão de Tratamento

```
                ┌─────────────┐
                │  Retryable? │
                └──────┬──────┘
                       │
              ┌────────┴────────┐
              │                 │
              ▼                 ▼
           ┌─────┐          ┌──────┐
           │ SIM │          │ NÃO  │
           └──┬──┘          └───┬──┘
              │                 │
              ▼                 ▼
      ┌──────────────┐    ┌──────────────┐
      │ Retry Logic  │    │   Fallback   │
      │ (Backoff)    │    │      UI      │
      └──────┬───────┘    └──────────────┘
             │
        ┌────┴────┐
        │         │
        ▼         ▼
    Sucesso    Falha
        │         │
        │         ▼
        │    ┌──────────────┐
        │    │   Fallback   │
        │    │      UI      │
        │    └──────────────┘
        │
        ▼
   ┌─────────┐
   │ Success │
   └─────────┘
```

## 🎯 Fluxo de useAsyncError

```
┌──────────────────────────────────────────────────────────┐
│                    useAsyncError                          │
└──────────────────────────────────────────────────────────┘
                          │
                          ▼
                  ┌───────────────┐
                  │   execute()   │
                  └───────┬───────┘
                          │
                          ▼
                  ┌───────────────┐
                  │  isLoading =  │
                  │     true      │
                  └───────┬───────┘
                          │
                          ▼
                  ┌───────────────┐
                  │  Try async    │
                  │   operation   │
                  └───────┬───────┘
                          │
                ┌─────────┴─────────┐
                │                   │
                ▼                   ▼
        ┌──────────────┐    ┌──────────────┐
        │   SUCCESS    │    │    ERROR     │
        └──────┬───────┘    └──────┬───────┘
               │                   │
               ▼                   ▼
        ┌──────────────┐    ┌──────────────┐
        │ data = result│    │ error = err  │
        │ isLoading =  │    │ isError =    │
        │    false     │    │    true      │
        └──────────────┘    └──────┬───────┘
                                   │
                          ┌────────┴────────┐
                          │   retryable?    │
                          └────────┬────────┘
                                   │
                          ┌────────┴────────┐
                          │                 │
                          ▼                 ▼
                    ┌──────────┐      ┌──────────┐
                    │   Retry  │      │  Show    │
                    │  (1/3)   │      │ Fallback │
                    └────┬─────┘      └──────────┘
                         │
                    ┌────┴────┐
                    │  Wait   │
                    │ (delay) │
                    └────┬────┘
                         │
                         ▼
                  ┌──────────────┐
                  │ Try again... │
                  └──────────────┘
```

## 🔔 Fluxo de Toast

```
┌──────────────────────────────────────────────────────────┐
│                   User Action                             │
└────────────────────┬─────────────────────────────────────┘
                     │
                     ▼
            ┌────────────────┐
            │  Try operation │
            └────────┬───────┘
                     │
            ┌────────┴────────┐
            │                 │
            ▼                 ▼
      ┌──────────┐      ┌──────────┐
      │ SUCCESS  │      │  ERROR   │
      └────┬─────┘      └────┬─────┘
           │                 │
           ▼                 ▼
    ┌─────────────┐   ┌─────────────┐
    │ showSuccess │   │  showError  │
    │   Toast     │   │    Toast    │
    └──────┬──────┘   └──────┬──────┘
           │                 │
           │                 ▼
           │          ┌─────────────┐
           │          │   Action?   │
           │          └──────┬──────┘
           │                 │
           │          ┌──────┴──────┐
           │          │             │
           │          ▼             ▼
           │     ┌────────┐    ┌────────┐
           │     │  Retry │    │ Dismiss│
           │     └────┬───┘    └────────┘
           │          │
           │          ▼
           │    ┌──────────────┐
           │    │ Try again... │
           │    └──────────────┘
           │
           ▼
    ┌─────────────┐
    │ Auto-dismiss│
    │  (5 sec)    │
    └─────────────┘
```

## 🌐 Fluxo de Network Error

```
┌──────────────────────────────────────────────────────────┐
│                  Network Request                          │
└────────────────────┬─────────────────────────────────────┘
                     │
                     ▼
            ┌────────────────┐
            │ Check Network  │
            │    Status      │
            └────────┬───────┘
                     │
            ┌────────┴────────┐
            │                 │
            ▼                 ▼
      ┌──────────┐      ┌──────────┐
      │  ONLINE  │      │ OFFLINE  │
      └────┬─────┘      └────┬─────┘
           │                 │
           ▼                 ▼
    ┌─────────────┐   ┌─────────────────┐
    │ Try Request │   │ NetworkError    │
    └──────┬──────┘   │   Fallback      │
           │          └─────────────────┘
    ┌──────┴──────┐
    │             │
    ▼             ▼
┌────────┐   ┌────────┐
│SUCCESS │   │ ERROR  │
└────────┘   └───┬────┘
                 │
                 ▼
          ┌──────────────┐
          │ isNetworkErr?│
          └──────┬───────┘
                 │
          ┌──────┴──────┐
          │             │
          ▼             ▼
    ┌──────────┐   ┌──────────┐
    │   YES    │   │    NO    │
    └────┬─────┘   └────┬─────┘
         │              │
         ▼              ▼
┌─────────────────┐ ┌──────────┐
│ NetworkError    │ │  Error   │
│   Fallback      │ │ Fallback │
└────────┬────────┘ └──────────┘
         │
         ▼
  ┌─────────────┐
  │ Monitor for │
  │   Online    │
  └──────┬──────┘
         │
         ▼
  ┌─────────────┐
  │ Auto Retry  │
  │ when online │
  └─────────────┘
```

## 🎭 Hierarquia de Error Boundaries

```
┌─────────────────────────────────────────────────────────────┐
│                    RootErrorBoundary                         │
│                  (Erros Críticos - Full Page)                │
│                                                              │
│  ┌────────────────────────────────────────────────────────┐ │
│  │              Page ErrorBoundary                         │ │
│  │           (Erros de Página - Partial)                   │ │
│  │                                                          │ │
│  │  ┌────────────────────────────────────────────────────┐ │ │
│  │  │          Section ErrorBoundary                      │ │ │
│  │  │        (Erros de Seção - Minimal)                   │ │ │
│  │  │                                                      │ │ │
│  │  │  ┌──────────────────────────────────────────────┐  │ │ │
│  │  │  │         Component                             │  │ │ │
│  │  │  │      (Throw Error)                            │  │ │ │
│  │  │  └──────────────────────────────────────────────┘  │ │ │
│  │  │                                                      │ │ │
│  │  │  Captura: Erros de componente específico           │ │ │
│  │  │  Fallback: Minimal (inline)                        │ │ │
│  │  │  Ação: Retry local                                 │ │ │
│  │  └────────────────────────────────────────────────────┘ │ │
│  │                                                          │ │
│  │  Captura: Erros não capturados por seção               │ │
│  │  Fallback: Default (card)                              │ │
│  │  Ação: Retry ou voltar                                 │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  Captura: Erros não capturados por página                  │
│  Fallback: Full (full screen)                              │
│  Ação: Reload página                                       │
└─────────────────────────────────────────────────────────────┘
```

## 🔄 Retry com Backoff Exponencial

```
Tentativa 1:
├─ Delay: 1s
├─ Tenta...
└─ Falha ❌

Tentativa 2:
├─ Delay: 2s (1s × 2^1)
├─ Tenta...
└─ Falha ❌

Tentativa 3:
├─ Delay: 4s (1s × 2^2)
├─ Tenta...
└─ Falha ❌

Max Retries Atingido:
└─ Mostra Fallback UI
```

## 📊 Fluxo de Monitoramento

```
┌──────────────────────────────────────────────────────────┐
│                    Error Occurs                           │
└────────────────────┬─────────────────────────────────────┘
                     │
                     ▼
            ┌────────────────┐
            │  Error Handler │
            └────────┬───────┘
                     │
        ┌────────────┼────────────┐
        │            │            │
        ▼            ▼            ▼
┌──────────┐  ┌──────────┐  ┌──────────┐
│  Log to  │  │ Capture  │  │  Send to │
│ Console  │  │   in     │  │ Monitoring│
│          │  │  Memory  │  │  Service │
└──────────┘  └──────────┘  └────┬─────┘
                                  │
                          ┌───────┴───────┐
                          │               │
                          ▼               ▼
                    ┌──────────┐    ┌──────────┐
                    │  Sentry  │    │ LogRocket│
                    └──────────┘    └──────────┘
```

## 🎯 Decisão de Fallback

```
                ┌─────────────┐
                │ Error Type? │
                └──────┬──────┘
                       │
        ┌──────────────┼──────────────┐
        │              │              │
        ▼              ▼              ▼
┌──────────────┐ ┌──────────┐ ┌──────────────┐
│   Network    │ │   404    │ │    Other     │
└──────┬───────┘ └────┬─────┘ └──────┬───────┘
       │              │              │
       ▼              ▼              ▼
┌──────────────┐ ┌──────────┐ ┌──────────────┐
│  Network     │ │ NotFound │ │    Error     │
│  Fallback    │ │ Fallback │ │   Fallback   │
└──────────────┘ └──────────┘ └──────────────┘
```

---

## 📝 Legenda

- 🔵 **Componente** - Elemento do sistema
- 🔄 **Fluxo** - Direção do processo
- ✅ **Sucesso** - Operação bem-sucedida
- ❌ **Erro** - Operação falhou
- 🔁 **Retry** - Tentativa novamente
- 📊 **Decisão** - Ponto de decisão
- 🎯 **Ação** - Ação do usuário

---

**Este diagrama ajuda a visualizar como o sistema funciona!** 🎨
